
<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>‡πÄ‡∏ä‡πá‡∏Ñ‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ | OK Mobile</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/html5-qrcode/minified/html5-qrcode.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    @layer utilities {
      .text-primary { color: #4f46e5; }
      .bg-primary { background-color: #4f46e5; }
    }
  </style>
</head>
<body class="bg-gradient-to-b from-indigo-100 to-white min-h-screen text-gray-800 font-sans">

  <!-- Header -->
  <header class="bg-white shadow p-6 text-center sticky top-0 z-10">
    <h1 class="text-3xl font-bold text-primary">üîç ‡πÄ‡∏ä‡πá‡∏Ñ‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h1>
    <p class="text-gray-600 mt-1">‡∏Å‡∏£‡∏≠‡∏Å Serial Number ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</p>
  </header>

  <!-- Warranty Check Box -->
  <main class="max-w-md mx-auto mt-8 px-4">
    <div class="bg-white rounded-2xl shadow-lg p-6">
      <label class="block mb-2 text-sm font-medium text-gray-700">Serial Number</label>
      <div class="flex items-center border border-gray-300 rounded overflow-hidden">
        <span class="px-3 text-gray-500">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none"
               viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M9 17v-6h13M6 17V5h13M3 17h.01" />
          </svg>
        </span>
        <input id="sn-input" type="text"
               class="w-full p-3 outline-none text-base"
               placeholder="‡∏Å‡∏£‡∏≠‡∏Å SN ‡πÄ‡∏ä‡πà‡∏ô ABC12345" />
      </div>
      <button onclick="checkWarranty()"
              class="mt-4 w-full bg-primary text-white py-2 rounded-lg font-semibold hover:bg-indigo-700 transition">
        ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ
      </button>

      <!-- QR Code Scanner -->
      <button id="qr-button" class="bg-primary text-white py-2 px-6 rounded-lg hover:bg-indigo-700 transition mt-4">üì∑ ‡∏™‡πÅ‡∏Å‡∏ô QR</button>
      <div id="qr-reader" class="mt-4" style="width: 100%; height: 300px;"></div>

      <div id="result" class="mt-6 text-center text-gray-700 text-sm"></div>

      <!-- ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ -->
      <div id="history" class="mt-8">
        <h3 class="text-lg font-semibold">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ</h3>
        <ul id="history-list" class="list-disc pl-5 text-sm text-gray-700"></ul>
      </div>

      <!-- ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î PDF -->
      <button id="download-pdf" class="bg-green-500 text-white py-2 px-6 rounded-lg hover:bg-green-700 transition mt-4">üíæ ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô</button>
    </div>
  </main>

  <!-- Script -->
  <script>
    let qrScanner;

    document.getElementById('qr-button').addEventListener('click', function() {
      qrScanner = new Html5QrcodeScanner("qr-reader", { fps: 10, qrbox: 250 });
      qrScanner.render(onScanSuccess);
    });

    function onScanSuccess(decodedText, decodedResult) {
      document.getElementById('sn-input').value = decodedText; // ‡∏Å‡∏£‡∏≠‡∏Å SN ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
      qrScanner.clear(); // ‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô
    }

    function checkWarranty() {
      const sn = document.getElementById('sn-input').value.trim();
      const resultDiv = document.getElementById('result');
      resultDiv.innerHTML = "‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...";

      if (!sn) {
        resultDiv.innerHTML = "<p class='text-red-500'>‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å Serial Number ‡∏Å‡πà‡∏≠‡∏ô</p>";
        return;
      }

      const apiUrl = `https://script.google.com/macros/s/AKfycbx7yAKkvZIBgLWiH7OUq7oeZXKAQaBKQINuwVmdxKINWFCBBsywnxnvwutuOv3dkzAR/exec?sn=${encodeURIComponent(sn)}`;

      fetch(apiUrl)
        .then(res => res.json())
        .then(data => {
          if (data.status === "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•") {
            resultDiv.innerHTML = `<div class="text-red-500">‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö SN ‡∏ô‡∏µ‡πâ</div>`;
          } else {
            resultDiv.innerHTML = `
              <div class="bg-indigo-50 border border-indigo-300 rounded-xl p-4 text-left shadow-md">
                <p class="text-lg font-semibold text-primary mb-2">‚úÖ ‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</p>
                <p><strong>üì± ‡∏£‡∏∏‡πà‡∏ô:</strong> ${data.model || '-'}</p>
                <p><strong>üóì ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠:</strong> ${data.purchase_date || '-'}</p>
                <p><strong>‚è∞ ‡∏´‡∏°‡∏î‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô:</strong> ${data.expiry_date || '-'}</p>
              </div>
            `;
          }

          saveHistory(sn, data.status);
        })
        .catch(err => {
          console.error(err);
          resultDiv.innerHTML = `<p class="text-red-500">‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ</p>`;
        });
    }

    function saveHistory(sn, result) {
      let history = JSON.parse(localStorage.getItem('checkHistory')) || [];
      const newEntry = { sn, result, date: new Date().toLocaleString() };
      history.push(newEntry);
      localStorage.setItem('checkHistory', JSON.stringify(history));

      displayHistory();
    }

    function displayHistory() {
      const history = JSON.parse(localStorage.getItem('checkHistory')) || [];
      const historyList = document.getElementById('history-list');
      historyList.innerHTML = '';

      history.forEach(entry => {
        const listItem = document.createElement('li');
        listItem.textContent = `${entry.date} - SN: ${entry.sn} (${entry.result})`;
        historyList.appendChild(listItem);
      });
    }

    window.onload = displayHistory;

    document.getElementById('download-pdf').addEventListener('click', function() {
      const doc = new jsPDF();
      const sn = document.getElementById('sn-input').value;
      const result = document.getElementById('result').innerHTML;
      const model = result.match(/‡∏£‡∏∏‡πà‡∏ô: ([^<]+)/)?.[1] || '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
      const purchaseDate = result.match(/‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠: ([^<]+)/)?.[1] || '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
      const expiryDate = result.match(/‡∏´‡∏°‡∏î‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô: ([^<]+)/)?.[1] || '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';

      doc.text("‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤", 20, 20);
      doc.text(`Serial Number: ${sn}`, 20, 30);
      doc.text(`‡∏£‡∏∏‡πà‡∏ô: ${model}`, 20, 40);
      doc.text(`‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠: ${purchaseDate}`, 20, 50);
      doc.text(`‡∏´‡∏°‡∏î‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô: ${expiryDate}`, 20, 60);
      doc.save("warranty.pdf");
    });
  </script>

</body>
</html>
