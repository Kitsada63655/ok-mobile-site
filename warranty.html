<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>‡πÄ‡∏ä‡πá‡∏Ñ‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ - OK Mobile</title>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      font-family: 'Arial', sans-serif;
      background-color: #f0f8ff;
      color: #333;
    }

    header {
      background-color: #4caf50;
      color: white;
      padding: 10px;
      text-align: center;
      font-size: 24px;
      font-weight: bold;
      position: relative;
    }

    header img {
      height: 40px;
      position: absolute;
      top: 10px;
      left: 10px;
    }

    .container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
      min-height: 80vh;
    }

    .input-container {
      background-color: #ffffff;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0px 0px 15px rgba(0, 0, 0, 0.1);
      width: 90%;
      max-width: 500px;
      text-align: center;
    }

    input[type="text"] {
      padding: 15px;
      width: 100%;
      margin: 10px 0;
      border-radius: 5px;
      border: 2px solid #4caf50;
      font-size: 16px;
      outline: none;
    }

    button, .back-button {
      padding: 12px 24px;
      margin-top: 10px;
      margin-inline: 5px;
      background-color: #4caf50;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
      transition: background-color 0.3s;
      text-decoration: none;
      display: inline-block;
    }

    button:hover, .back-button:hover {
      background-color: #388e3c;
    }

    .result {
      margin-top: 20px;
      font-size: 18px;
      color: #333;
      text-align: center;
    }

    .result.success { color: #388e3c; }
    .result.error { color: #f44336; }

    .footer {
      background-color: #4caf50;
      color: white;
      text-align: center;
      padding: 15px 0;
    }

    #history {
      margin-top: 30px;
      text-align: left;
      font-size: 14px;
    }

    .btn-row {
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
    }
  </style>
</head>
<body>

  <header>
    <img src="https://i.imgur.com/nvYSgCM.jpeg" alt="OK Mobile Logo" />
    ‡πÄ‡∏ä‡πá‡∏Ñ‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ - OK Mobile
  </header>

  <div class="container">
    <div class="input-container">
      <label for="serialNumber">‡πÄ‡∏ä‡πá‡∏Ñ‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠‡∏à‡∏≤‡∏Å‡∏£‡πâ‡∏≤‡∏ô‡πÇ‡∏≠‡πÄ‡∏Ñ‡πÇ‡∏°‡∏ö‡∏≤‡∏¢ ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô !!üì±:</label>
      <input type="text" id="serialNumber" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç IMEI (‡∏Å‡∏î‡πÄ‡∏ä‡πá‡∏Ñ *#06#)">
      
      <div class="btn-row">
        <button onclick="checkWarranty()">‡πÄ‡∏ä‡πá‡∏Ñ‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô</button>
        <button onclick="scanQRCode()">‡∏™‡πÅ‡∏Å‡∏ô QR Code</button>
        <a href="index.html" class="back-button">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</a>
      </div>

      <div id="result" class="result"></div>
      <div id="history"></div>
    </div>
  </div>

  <div class="footer">
    ¬©OK-MOBILE2024 Ver.1.3 | ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡πÅ‡∏à‡πâ‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô ‡πÇ‡∏ó‡∏£.094-6613961
  </div>

  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
  <script>
    const apiKey = "AIzaSyBCtEQL9aVLIFMVnTdAXhRnz3vm__3eQ1M";
    const spreadsheetId = "1Jaf3ifI-pJhDng9TQ0_0X4taa2rUfUscGBxocWW6s14";
    const range = "Sheet1!A2:F";

    function showResult(html, type) {
      const result = document.getElementById("result");
      result.innerHTML = html;
      result.className = `result ${type}`;
    }

    function checkWarranty() {
      const sn = document.getElementById("serialNumber").value.trim();
      if (!sn) {
        showResult("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç IMEI", "error");
        return;
      }

      const url = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${range}?key=${apiKey}`;
      fetch(url)
        .then(res => res.json())
        .then(data => {
          let found = false;
          data.values.forEach(row => {
            if (row[0] === sn) {
              found = true;
              showResult(`
                <p><strong>‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏∏‡πà‡∏ô:</strong> ${row[1]}</p>
                <p><strong>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢:</strong> ${row[2]}</p>
                <p><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠:</strong> ${row[3]}</p>
                <p><strong>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</strong> ${row[4]}</p>
              `, "success");
              saveHistory(sn);
            }
          });
          if (!found) {
            showResult("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏ô‡∏µ‡πâ", "error");
          }
        })
        .catch(err => {
          console.error(err);
          showResult("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•", "error");
        });
    }

    function saveHistory(sn) {
      let history = JSON.parse(localStorage.getItem("warrantyHistory")) || [];
      if (!history.includes(sn)) {
        history.unshift(sn);
        localStorage.setItem("warrantyHistory", JSON.stringify(history.slice(0, 5)));
        renderHistory();
      }
    }

    function renderHistory() {
      const history = JSON.parse(localStorage.getItem("warrantyHistory")) || [];
      const historyDiv = document.getElementById("history");
      if (history.length > 0) {
        historyDiv.innerHTML = `<h4>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î:</h4><ul>${history.map(sn => `<li>${sn}</li>`).join('')}</ul>`;
      } else {
        historyDiv.innerHTML = "";
      }
    }

    function scanQRCode() {
      const qrRegionId = "reader";
      const qrDiv = document.createElement("div");
      qrDiv.id = qrRegionId;
      qrDiv.style = "width:300px;margin:10px auto;";
      document.querySelector(".input-container").appendChild(qrDiv);

      const html5QrCode = new Html5Qrcode(qrRegionId);
      html5QrCode.start(
        { facingMode: "environment" },
        { fps: 10, qrbox: 250 },
        qrCodeMessage => {
          document.getElementById("serialNumber").value = qrCodeMessage;
          html5QrCode.stop();
          qrDiv.remove();
        },
        error => {}
      ).catch(err => {
        alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ");
        qrDiv.remove();
      });
    }

    // ‡πÇ‡∏´‡∏•‡∏î‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤
    renderHistory();
  </script>
</body>
</html>
