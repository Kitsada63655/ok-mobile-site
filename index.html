<script>
  async function loadProducts() {
    const sheetId = '2PACX-1vR3Ks0x16haRC2E60V7UzcEYGul-goV234Uenpln-wtFCtFgkoxUfTeGlBnSEZr65MisugNJtR1AvQF';
    // เพิ่ม gid=0&single=true
    const csvUrl  = `https://docs.google.com/spreadsheets/d/e/${sheetId}/pub?gid=0&single=true&output=csv`;

    const res  = await fetch(csvUrl);
    let text = await res.text();

    // ตัด BOM ออก ถ้ามี
    text = text.replace(/^\uFEFF/, '');

    const rows = text.trim().split('\n');
    const header = rows.shift().split(',');

    console.log('HEADER:', header);

    const idx = {
      name:  header.indexOf('name'),
      price: header.indexOf('price'),
      image: header.indexOf('image')
    };
    console.log('INDEXES:', idx);

    const productList = document.getElementById('product-list');
    productList.innerHTML = '';

    rows.forEach((line, i) => {
      console.log(`ROW ${i}:`, line);
      const cols  = line.split(',');
      console.log(`COLS ${i}:`, cols);
      const name  = cols[idx.name]?.trim()  || '–';
      const price = cols[idx.price]?.trim() || '0';
      const image = cols[idx.image]?.trim() || '';

      const card = document.createElement('div');
      card.className = 'bg-white p-4 rounded-2xl shadow hover:shadow-lg transition';
      card.innerHTML = `
        <img src="${image}" alt="${name}"
             class="rounded mb-3 w-full h-48 object-cover"
             onerror="this.src='https://i.imgur.com/Cy560I4.jpg'">
        <h3 class="text-lg font-bold">${name}</h3>
        <p class="text-secondary font-semibold">฿${price}</p>
        <button onclick="addToCart('${name}',${price})"
                class="mt-2 px-4 py-2 bg-primary text-white rounded hover:bg-indigo-700">
          สั่งซื้อ
        </button>
      `;
      productList.appendChild(card);
    });

    updateCartDisplay();
  }

  // เรียกเมื่อหน้าโหลด
  loadProducts();
</script>
